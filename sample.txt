import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;

public class ScrollScreenshotUtil {

    /**
     * Smoothly scrolls down the page while taking screenshots via ReportLogger.logWithScreenshot(),
     * then scrolls back up to the top smoothly.
     *
     * @param driver          WebDriver instance
     * @param scrollPauseTime pause time (in ms) between viewport screenshots
     * @param scrollStep      pixels to move per smooth step (e.g. 200)
     */
    public static void captureFullPageScreenshots(WebDriver driver, int scrollPauseTime, int scrollStep) {
        JavascriptExecutor js = (JavascriptExecutor) driver;

        long scrollHeight = (Long) js.executeScript("return document.body.scrollHeight");
        long clientHeight = (Long) js.executeScript("return window.innerHeight");

        long currentPosition = 0;
        int screenshotCount = 1;

        System.out.println("Starting smooth scroll down with screenshots...");

        // ðŸ”½ SCROLL DOWN
        while (currentPosition < scrollHeight) {
            String screenshotName = "ScrollShot_" + screenshotCount;
            ReportLogger.logWithScreenshot(screenshotName);
            screenshotCount++;

            long targetPosition = currentPosition + clientHeight;

            // Smooth scroll step-by-step
            for (long y = currentPosition; y < targetPosition && y < scrollHeight; y += scrollStep) {
                js.executeScript("window.scrollTo(0, arguments[0]);", y);
                try {
                    Thread.sleep(50);
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }

            // Wait for lazy-loaded content
            try {
                Thread.sleep(scrollPauseTime);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }

            // Update position and page height (dynamic handling)
            currentPosition = ((Number) js.executeScript("return window.pageYOffset;")).longValue();
            scrollHeight = ((Number) js.executeScript("return document.body.scrollHeight;")).longValue();
        }

        // Final screenshot at the very bottom
        ReportLogger.logWithScreenshot("ScrollShot_Final");
        System.out.println("Reached bottom of page. Total screenshots: " + screenshotCount);

        // ðŸ”¼ SCROLL UP
        System.out.println("Scrolling smoothly back to top...");
        for (long y = scrollHeight; y >= 0; y -= scrollStep) {
            js.executeScript("window.scrollTo(0, arguments[0]);", y);
            try {
                Thread.sleep(30); // slightly faster scroll up
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }

        System.out.println("Scroll up complete.");
    }
}
