/**
     * Scrolls down the page in increments, pausing after each scroll
     * and printing the scroll number.
     *
     * @param driver The WebDriver instance to use.
     * @param scrollStepPixels The number of pixels to scroll in each step.
     * @param pauseMillis The time to pause after each scroll, in milliseconds (e.g., 1000 for 1 second).
     */
    public static void scrollPageInSteps(WebDriver driver, int scrollStepPixels, int pauseMillis) {
        // Cast the driver to JavascriptExecutor
        JavascriptExecutor js = (JavascriptExecutor) driver;

        try {
            // Get the total height of the page
            long pageHeight = (Long) js.executeScript("return document.body.scrollHeight");
            long currentScroll = 0;
            int scrollNumber = 1;

            System.out.println("Starting scroll. Total page height: " + pageHeight + "px");

            // Loop while the current scroll position is less than the total page height
            while (currentScroll < pageHeight) {
                // Scroll down by the specified step
                js.executeScript("window.scrollBy(0, " + scrollStepPixels + ");");

                // Wait for the specified pause duration
                Thread.sleep(pauseMillis);

                // Print the scroll number *before* checking the new position
                System.out.println("Scroll number: " + scrollNumber);
                scrollNumber++;

                // Get the new scroll position
                long newScrollPosition = (Long) js.executeScript("return window.pageYOffset;");

                // Check if we've reached the bottom
                // 1. If the new position is the same as the old, we're stuck (at the bottom)
                // 2. If the new position plus window height is >= page height, we're at the bottom
                long windowHeight = (Long) js.executeScript("return window.innerHeight");

                if (newScrollPosition == currentScroll || (newScrollPosition + windowHeight) >= pageHeight) {
                    System.out.println("Reached the bottom of the page.");
                    break; // Exit the loop
                }

                // Update the current scroll position for the next loop
                currentScroll = newScrollPosition;
            }

        } catch (InterruptedException e) {
            System.err.println("Scroll loop was interrupted.");
            Thread.currentThread().interrupt(); // Restore the interrupted status
        } catch (Exception e) {
            System.err.println("An error occurred during scrolling: " + e.getMessage());
            e.printStackTrace();
        }
    }
