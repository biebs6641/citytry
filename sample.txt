import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;

public class ScrollScreenshotUtil {

    public static void captureFullPageScreenshots(WebDriver driver, int scrollPauseTime, int scrollStep) {
        JavascriptExecutor js = (JavascriptExecutor) driver;

        long scrollHeight = ((Number) js.executeScript("return document.body.scrollHeight")).longValue();
        long clientHeight = ((Number) js.executeScript("return window.innerHeight")).longValue();

        long currentPosition = 0;
        int screenshotCount = 1;

        System.out.println("Starting smooth scroll down with screenshots...");

        // ðŸ”½ SCROLL DOWN
        while (currentPosition < scrollHeight) {
            String screenshotName = "ScrollShot_" + screenshotCount;
            ReportLogger.logWithScreenshot(screenshotName);
            screenshotCount++;

            long targetPosition = currentPosition + clientHeight;

            // Smooth scroll step-by-step
            for (long y = currentPosition; y < targetPosition && y < scrollHeight; y += scrollStep) {
                js.executeScript("window.scrollTo(0, arguments[0]);", y);
                try {
                    Thread.sleep(50);
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }

            // Pause to let new content load
            try {
                Thread.sleep(scrollPauseTime);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }

            // Update positions dynamically
            currentPosition = ((Number) js.executeScript("return window.pageYOffset;")).longValue();
            scrollHeight = ((Number) js.executeScript("return document.body.scrollHeight;")).longValue();
        }

        // Final screenshot at bottom
        ReportLogger.logWithScreenshot("ScrollShot_Final");
        System.out.println("Reached bottom. Total screenshots: " + screenshotCount);

        // Short wait before scrolling up
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }

        // ðŸ”¼ SCROLL UP
        System.out.println("Scrolling smoothly back to top...");

        long currentYOffset = ((Number) js.executeScript("return window.pageYOffset;")).longValue();
        while (currentYOffset > 0) {
            currentYOffset -= scrollStep;
            if (currentYOffset < 0) currentYOffset = 0; // prevent negative scroll
            js.executeScript("window.scrollTo(0, arguments[0]);", currentYOffset);
            try {
                Thread.sleep(30); // fast but smooth upward scroll
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }

        System.out.println("Smooth scroll up completed successfully âœ…");
    }
}
