package com.cucumber.utils;

import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.openqa.selenium.WebDriver;

import com.aventstack.extentreports.MediaEntityBuilder;
import com.aventstack.extentreports.ExtentTest;
import com.cucumber.base.DriverFactory;

public class ReportLogger {

    private static ExtentTest test;

    // Called from Hooks to set current ExtentTest
    public static void setTest(ExtentTest extentTest) {
        test = extentTest;
    }

    // Capture screenshot as Base64
    private static String captureScreenshotBase64(WebDriver driver) {
        return ((TakesScreenshot) driver).getScreenshotAs(OutputType.BASE64);
    }

    // Log with screenshot
    public static void logWithScreenshot(String message) {
        WebDriver driver = DriverFactory.getDriver();
        if (test != null && driver != null) {
            String base64Screenshot = captureScreenshotBase64(driver);
            test.info(message,
                    MediaEntityBuilder.createScreenCaptureFromBase64String(base64Screenshot, message).build());
        } else if (test != null) {
            test.info(message);
        }
    }

    // Log text only
    public static void log(String message) {
        if (test != null) {
            test.info(message);
        }
    }
}
